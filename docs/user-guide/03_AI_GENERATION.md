# 🤖 AI 智能生成指南

> **完整工作流第三步**：采集 API → 编排流程 → **AI 生成** → 执行测试

---

## 📋 目录

- [概述](#概述)
- [5 分钟上手](#5-分钟上手)
- [接口测试 vs E2E 测试](#接口测试-vs-e2e-测试)
- [统一分类功能](#统一分类功能-新)
- [支持的 AI 提供商](#支持的-ai-提供商)
- [高级技巧](#高级技巧)
- [最佳实践](#最佳实践)
- [常见问题](#常见问题)

---

## 📖 概述

AI 智能生成是 AI TestMind 的核心功能，只需用自然语言描述测试需求，AI 就能自动生成完整的测试用例。

### ✨ 从描述到用例，只需 30 秒

```
1. 输入测试需求（自然语言）
   ↓
2. AI 智能思考
   - 搜索相关 API
   - 设计测试场景
   - 生成断言和清理
   ↓
3. 生成完整用例
   - 自动统一分类
   - 智能标签管理
   - 一键保存
```

### 🎯 核心优势

| 传统方式 | AI TestMind | 效率提升 |
|---------|-------------|---------|
| 手写脚本 30 分钟 | 描述需求 30 秒 | **60x** |
| 逐个创建用例 | 批量生成用例 | **10x** |
| 手动添加断言 | 智能断言生成 | **20x** |
| 手写清理逻辑 | 自动后置清理 | **∞** |

---

## 🚀 5 分钟上手

### 步骤 1: 打开 AI 生成页面

```
导航栏 → "AI 生成" → 点击进入
```

### 步骤 2: 配置 AI 服务

```
首次使用需要配置 AI 服务：

1. 点击"设置" → "AI 配置"
2. 选择 AI 提供商（如 DeepSeek）
3. 输入 API Key
4. 测试连接
5. 保存
```

### 步骤 3: 描述测试需求

**示例 1 - 简单描述:**

```
测试用户创建接口
```

AI 会自动生成：
- ✅ 用户创建 - 正常用例
- ✅ 用户创建 - 参数为空

**示例 2 - 详细描述:**

```
测试用户创建接口，username 和 email 不能为空，
创建成功后要清理数据
```

AI 会生成：
- ✅ 用户创建 - 正常用例（含清理）
- ✅ 用户创建 - username 为空
- ✅ 用户创建 - email 为空

### 步骤 4: 选择测试类型

```
🔘 接口测试（API Test）
   - 针对单个接口的各种场景测试
   - 自动生成正常 + 异常用例

🔘 E2E 流程测试（E2E Flow Test）
   - 端到端的业务流程测试
   - 严格按描述生成步骤
```

### 步骤 5: 点击生成

```
1. 点击"生成用例"按钮
2. AI 开始思考（实时显示进度）
3. 生成完成，显示结果
4. 查看并确认用例
```

🎉 完成！用例已自动保存到数据库。

---

## 🎯 接口测试 vs E2E 测试

### 接口测试（API Test）

**特点：**
- 🎯 关注单个接口的各种场景
- 📋 自动生成多个用例（正常 + 异常）
- ✅ 每个用例测试不同的参数组合

**适用场景：**
```
✅ 参数校验测试
✅ 边界值测试
✅ 异常情况测试
✅ 单接口功能验证
```

**示例：**

输入：
```
测试用户创建接口，username 和 email 不能为空
```

输出：
```
✅ 用户创建 - 正常用例（2 个步骤，含清理）
   1. 创建用户（username="testuser${{random(8)}}", email="test@example.com"）
   2. 删除用户（清理数据）

✅ 用户创建 - username 为空（1 个步骤）
   1. 创建用户（username=""，期望失败）

✅ 用户创建 - email 为空（1 个步骤）
   1. 创建用户（email=""，期望失败）

📁 统一分类：用户管理
🏷️ 标签：["参数校验", "接口测试", "AI生成"]
```

---

### E2E 流程测试（E2E Flow Test）

**特点：**
- 🔗 关注完整的业务流程
- 📝 严格按用户描述生成
- 🎯 每个用例是一个端到端流程

**适用场景：**
```
✅ 业务流程验证
✅ 集成测试
✅ 端到端场景
✅ 多步骤协作
```

**示例：**

输入：
```
测试用户登录后创建订单的完整流程
```

输出：
```
✅ E2E - 用户登录 - 创建订单（3 个步骤，含清理）
   1. 用户登录（获取 token）
   2. 创建订单（使用 token，获取 orderId）
   3. 删除订单（清理数据）

✅ E2E - 用户登录 - 查询订单（2 个步骤）
   1. 用户登录（获取 token）
   2. 查询订单列表（使用 token）

✅ E2E - 异常: 未登录创建订单（1 个步骤）
   1. 创建订单（不带 token，期望失败）

📁 统一分类：订单管理
🏷️ 标签：["E2E测试", "流程测试", "AI生成"]
```

---

## 📁 统一分类功能 ⭐ 新

### 什么是统一分类？

**核心规则：**
> 同一批生成的所有测试用例，会自动使用相同的业务分类

这意味着：
- ✅ 所有用例归属到同一个业务模块
- ✅ 便于查找和管理
- ✅ 清晰的测试覆盖度

### 为什么需要统一分类？

**改进前：**
```
❌ 用户列表  → 分类：用户查询
❌ 用户创建  → 分类：用户创建
❌ 用户删除  → 分类：用户删除
❌ 用户修改  → 分类：用户修改

问题：分类过于分散，难以管理
```

**改进后：**
```
✅ 用户列表  → 分类：用户管理
✅ 用户创建  → 分类：用户管理
✅ 用户删除  → 分类：用户管理
✅ 用户修改  → 分类：用户管理

优势：统一归类，一目了然
```

### 分类命名规则

AI 会根据以下原则确定分类名称：

1. **从需求中提取核心业务领域**
   ```
   输入："测试用户创建接口"
   分类：用户管理
   ```

2. **使用业务模块名，不用操作动词**
   ```
   ✅ 商品管理（而不是"创建商品"）
   ✅ 订单管理（而不是"查询订单"）
   ✅ 文章管理（而不是"删除文章"）
   ```

3. **简洁明确，2-6 个字**
   ```
   ✅ 用户管理
   ✅ 订单管理
   ✅ 商品管理
   ✅ 文章管理
   ✅ 评论管理
   ```

### 实际案例

**案例 1：用户管理**

输入：
```
测试用户的增删改查功能
```

生成 4 个用例：
```
✅ 用户创建 - 正常用例
✅ 用户查询 - 列表查询
✅ 用户修改 - 更新信息
✅ 用户删除 - 删除用户

📁 统一分类：用户管理  ← 所有用例使用相同分类
```

**案例 2：商品管理**

输入：
```
测试商品发布、编辑、下架的流程
```

生成 3 个用例：
```
✅ E2E - 发布商品
✅ E2E - 编辑商品
✅ E2E - 下架商品

📁 统一分类：商品管理  ← 所有用例使用相同分类
```

**案例 3：订单流程**

输入：
```
测试从下单到支付的完整流程
```

生成用例：
```
✅ E2E - 创建订单 - 支付订单
✅ E2E - 创建订单 - 取消订单
✅ E2E - 异常: 支付金额不足

📁 统一分类：订单管理  ← 所有用例使用相同分类
```

### 标签 vs 分类

**分类（Category）：**
- 📁 业务模块或功能领域
- 🎯 同批用例必须相同
- 📊 用于组织和筛选

**标签（Tags）：**
- 🏷️ 测试类型和特征
- 🔄 可以不同
- 🔍 用于多维度筛选

**示例：**
```
用例 1：用户创建 - 正常用例
├─ 📁 分类：用户管理
└─ 🏷️ 标签：["接口测试", "正常场景", "AI生成"]

用例 2：用户创建 - 参数为空
├─ 📁 分类：用户管理  ← 分类相同
└─ 🏷️ 标签：["接口测试", "异常场景", "AI生成"]  ← 标签可不同
```

---

## 🤖 支持的 AI 提供商

### 1. DeepSeek（推荐）⭐

**为什么推荐：**
- 💰 **价格最低**：0.14 元 / 百万 tokens
- ⚡ **响应快速**：平均 2-3 秒
- 🎯 **效果优秀**：专为中文优化

**配置方法：**
```
1. 注册账号：https://platform.deepseek.com
2. 创建 API Key
3. 在 AI TestMind 设置中配置：
   - 提供商：DeepSeek
   - API Key：sk-xxx
   - 模型：deepseek-chat
```

### 2. OpenAI

**适用场景：**
- 🌍 国际化项目
- 📊 复杂业务逻辑
- 🎯 需要 GPT-4 能力

**配置方法：**
```
提供商：OpenAI
模型：gpt-4-turbo-preview 或 gpt-3.5-turbo
API Key：sk-xxx
Base URL：https://api.openai.com/v1（可选自定义）
```

### 3. Ollama（本地部署）

**优势：**
- 🔒 数据完全私有
- 💰 完全免费
- 🚀 无网络限制

**配置方法：**
```bash
# 1. 安装 Ollama
curl -fsSL https://ollama.ai/install.sh | sh

# 2. 下载模型
ollama pull qwen2.5:7b

# 3. 启动服务
ollama serve

# 4. 在 AI TestMind 配置
提供商：Ollama
Base URL：http://localhost:11434
模型：qwen2.5:7b
```

### 4. 其他提供商

- **Claude (Anthropic)**: 高质量输出
- **百度文心一言**: 中文优化
- **阿里通义千问**: 中文优化
- **智谱 AI**: 中文优化

---

## 💡 高级技巧

### 1. 精确描述提高质量

**❌ 模糊描述：**
```
测试订单
```

**✅ 精确描述：**
```
测试订单创建接口，orderId、productId、quantity 不能为空，
quantity 必须大于 0，创建成功后要清理数据
```

### 2. 指定场景类型

**明确测试类型：**
```
接口测试：测试用户创建接口的参数校验
E2E 测试：测试用户登录后创建订单的完整流程
```

### 3. 使用领域术语

**❌ 通用描述：**
```
测试创建功能
```

**✅ 业务术语：**
```
测试商品发布功能，包括标题、价格、库存的必填校验
```

### 4. 明确清理需求

**提示清理：**
```
测试订单创建，成功后要删除订单（清理数据）
```

AI 会自动：
- 为正常用例添加清理步骤
- 异常用例不添加清理
- 使用智能搜索找到删除 API

### 5. 批量生成

**一次描述多个场景：**
```
测试商品管理的完整功能：
1. 发布商品（含参数校验）
2. 编辑商品信息
3. 上下架商品
4. 删除商品
```

AI 会生成多个用例，全部归类到"商品管理"。

---

## 🎯 最佳实践

### 1. 先采集再生成

```
推荐流程：
1. 使用 API 采集功能收集接口
2. 确保 API 信息完整
3. 再使用 AI 生成
```

原因：
- AI 需要从 API 仓库搜索接口
- 完整的 API 信息能生成更准确的用例

### 2. 分批生成

```
✅ 按业务模块分批：
- 第一批：用户管理相关
- 第二批：订单管理相关
- 第三批：商品管理相关

❌ 一次生成所有：
- 描述过长，AI 可能遗漏
- 分类可能不准确
```

### 3. 检查和调整

生成后建议检查：
```
✅ 分类是否合理
✅ 参数值是否使用了随机函数
✅ 断言是否充分
✅ 清理步骤是否正确
```

### 4. 补充手动用例

AI 生成 + 手动编排相结合：
```
1. 用 AI 生成基础用例（快速）
2. 手动添加特殊场景（精确）
3. 形成完整的测试套件
```

---

## ❓ 常见问题

### Q1: AI 生成失败怎么办？

**可能原因：**
1. AI 服务配置错误
2. API Key 无效
3. 网络问题
4. API 仓库中没有相关接口

**解决方案：**
```bash
# 1. 检查配置
设置 → AI 配置 → 测试连接

# 2. 检查 API 仓库
确保已采集相关的 API

# 3. 查看详细日志
开发者工具 → Console → 查看错误信息

# 4. 重试
调整描述后重新生成
```

### Q2: 生成的用例不符合预期

**优化描述：**
```
❌ 模糊：测试用户
✅ 精确：测试用户创建接口，username 和 email 必填

❌ 过长：写了一大段需求文档
✅ 适中：3-5 句话描述核心需求

❌ 混杂：把多个模块混在一起
✅ 清晰：每次只描述一个模块
```

### Q3: 分类不准确怎么办？

**手动调整：**
```
1. 进入测试用例列表
2. 批量选择相关用例
3. 点击"批量编辑"
4. 修改分类
5. 保存
```

**提供更明确的描述：**
```
❌ "测试创建功能"
✅ "测试订单管理模块的订单创建功能"
```

### Q4: 如何生成更多异常用例？

**明确指定：**
```
测试用户创建接口，验证以下异常场景：
1. username 为空
2. username 重复
3. email 格式错误
4. password 长度不足
```

### Q5: 生成的用例没有清理步骤

**明确提示：**
```
测试订单创建接口，创建成功后要删除订单
```

或者：
```
测试订单创建接口（包含后置清理）
```

---

## 📊 效率对比

### 传统方式 vs AI 生成

**场景：创建一个包含 10 个测试用例的测试套件**

| 步骤 | 传统方式 | AI TestMind |
|------|---------|-------------|
| 分析需求 | 30 分钟 | 2 分钟 |
| 编写用例 | 2 小时 | 30 秒 |
| 添加断言 | 1 小时 | 自动 |
| 配置清理 | 30 分钟 | 自动 |
| 分类管理 | 15 分钟 | 自动 |
| **总计** | **4+ 小时** | **3 分钟** |
| **效率** | 基准 | **80x** 🚀 |

---

## 🎓 进阶教程

### 自定义 AI 提示词

如果你熟悉 AI，可以自定义系统提示词：

```typescript
// lib/ai-prompts/system-prompt.ts

export const customPrompt = `
你是一个专业的测试用例生成助手。

额外规则：
1. 优先生成边界值测试
2. 每个用例至少包含 3 个断言
3. 分类命名使用项目特定术语
...
`;
```

### 与 CI/CD 集成

```yaml
# .github/workflows/generate-tests.yml
name: AI Generate Tests

on:
  schedule:
    - cron: '0 0 * * 0'  # 每周日生成

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Generate Tests
        env:
          AI_API_KEY: ${{ secrets.AI_API_KEY }}
        run: |
          npm run ai:generate -- \
            --input "测试用户管理模块" \
            --type api
```

---

## 📚 相关文档

- [API 智能采集](05_API_CAPTURE.md) - 采集 API 到仓库
- [可视化编排](04_FLOW_ORCHESTRATION.md) - 手动编排流程
- [执行与监控](06_EXECUTION.md) - 运行测试用例
- [最佳实践](09_BEST_PRACTICES.md) - 更多技巧

---

## 💡 下一步

生成用例后，你可以：

1. ✅ [立即执行测试](06_EXECUTION.md)
2. ✏️ [手动编辑和优化用例](04_FLOW_ORCHESTRATION.md)
3. 📊 [查看测试报告](07_REPORTS.md)
4. 📦 [组织成测试套件](08_TEST_SUITES.md)

---

<div align="center">

**有问题？**

查看 [FAQ](../FAQ.md) 或加入 [Discord 社区](https://discord.gg/aitestmind)

**准备好开始了吗？**

[🎬 采集你的第一个 API →](05_API_CAPTURE.md)

[⬅️ 返回文档首页](../README.md)

</div>



