# 🗂️ API 仓库管理指南

> **API 仓库**是 AI TestMind 的核心数据中心，所有采集和手动创建的 API 都存储在这里，供后续测试编排和 AI 生成使用。

---

## 📋 目录

- [概述](#概述)
- [访问 API 仓库](#访问-api-仓库)
- [API 卡片详情](#api-卡片详情)
- [API 管理操作](#api-管理操作)
  - [创建 API](#创建-api)
  - [编辑 API](#编辑-api)
  - [删除 API](#删除-api)
  - [批量操作](#批量操作)
- [搜索和筛选](#搜索和筛选)
- [分类管理](#分类管理)
- [导入API](#导入API)
- [最佳实践](#最佳实践)
- [常见问题](#常见问题)

---

## 📖 概述

### 什么是 API 仓库？

API 仓库是一个集中管理所有 API 接口的地方，包括：

- 📡 **采集的 API**: 通过 Playwright、HAR、mitmproxy 等方式自动采集
- ✍️ **手动创建的 API**: 手动添加的 API 接口
- 🏷️ **分类和标签**: 自动或手动分类，便于管理
- 📝 **完整信息**: URL、方法、参数、响应示例、Schema 等

### 为什么需要 API 仓库？

- ✅ **统一管理**: 所有 API 集中存储，避免重复
- ✅ **快速查找**: 通过搜索和筛选快速定位 API
- ✅ **可视化编排**: 拖拽 API 到流程画布构建测试
- ✅ **AI 生成基础**: AI 从仓库中搜索合适的 API 生成测试用例
- ✅ **团队协作**: 团队成员共享 API 库

---

## 🌐 访问 API 仓库

### 方式 1: 通过导航栏

```
访问 http://localhost:3000/api-repository
```

或点击左侧导航栏的 "API 仓库" 菜单。

### 方式 2: 通过快捷链接

在以下页面可以快速跳转到 API 仓库：
- 📊 仪表盘 - "API 仓库"卡片
- 🎬 API 采集页面 - "查看 API 仓库"按钮
- 🎨 测试编排页面 - "API 列表"面板

---

## 📇 API 卡片详情

每个 API 以卡片形式展示，包含以下信息：

### 基本信息

```
┌─────────────────────────────────────┐
│ 🟢 POST /api/orders                  │
│                                     │
│ 📝 创建订单                          │
│ 🏷️ 订单管理 · 订单创建               │
│                                     │
│ 📊 请求参数: 5                       │
│ 📄 响应字段: 12                      │
│ ⏱️ 平均响应时间: 123ms               │
│                                     │
│ 🏷️ 标签: [核心功能] [需要登录]        │
│                                     │
│ 📅 最后更新: 2024-12-01 10:30        │
└─────────────────────────────────────┘
```

### 点击查看详情

点击卡片可以查看完整信息：

```json
{
  "id": "api_001",
  "name": "创建订单",
  "method": "POST",
  "url": "http://api.example.com/api/orders",
  "path": "/api/orders",
  
  "classification": {
    "platform": "电商平台",
    "component": "订单管理",
    "feature": "订单创建"
  },
  
  "requestHeaders": {
    "Content-Type": "application/json",
    "Authorization": "Bearer {{token}}"
  },
  
  "requestBody": {
    "productId": "PRD001",
    "quantity": 2,
    "price": 99.99
  },
  
  "requestSchema": {
    "type": "object",
    "properties": {
      "productId": {
        "type": "string",
        "required": true,
        "description": "商品ID"
      },
      "quantity": {
        "type": "integer",
        "required": true,
        "description": "购买数量"
      },
      "price": {
        "type": "number",
        "required": true,
        "description": "单价"
      }
    }
  },
  
  "responseExample": {
    "code": 200,
    "message": "success",
    "data": {
      "orderId": "ORD123456",
      "status": "pending",
      "createTime": "2024-12-01T10:30:00Z"
    }
  },
  
  "tags": ["核心功能", "需要登录", "数据修改"],
  
  "stats": {
    "usageCount": 15,
    "avgResponseTime": 123,
    "successRate": 98.5
  }
}
```

---

## 🛠️ API 管理操作

### 创建 API

#### 方式 1: 手动创建

```
1. 点击右上角 "新建 API" 按钮
2. 填写基本信息：
   - 名称: 创建订单
   - 方法: POST
   - URL: http://api.example.com/api/orders
   
3. 添加请求信息：
   - Headers
   - Query 参数
   - Body（JSON/Form/Raw）
   
4. 添加响应示例（可选）

5. 设置分类和标签

6. 点击 "保存" 按钮
```

#### 方式 2: 通过采集

参考 [API 采集指南](05_API_CAPTURE.md) 自动采集 API，支持以下采集方式：
- Playwright 浏览器录制
- HAR 文件导入（在采集页面）
- mitmproxy 代理录制

### 编辑 API

```
1. 点击 API 卡片进入详情页
2. 点击右上角 "编辑" 按钮
3. 修改任何信息：
   - 基本信息（名称、URL、方法）
   - 请求配置（Headers、参数、Body）
   - 分类和标签
   - 响应示例
4. 点击 "保存" 按钮
```

**快速编辑：**
- 双击卡片上的任意字段快速编辑
- 支持批量修改分类和标签

### 删除 API

**单个删除：**
```
1. 点击 API 卡片
2. 点击右上角 "删除" 按钮
3. 确认删除
```

**批量删除：**
```
1. 选中多个 API（勾选复选框）
2. 点击顶部 "批量删除" 按钮
3. 确认删除
```

⚠️ **注意**: 
- 删除 API 不会影响已创建的测试用例
- 测试用例中引用的 API 会显示为"已删除"状态
- 建议先检查 API 的使用情况再删除

### 批量操作

选中多个 API 后可以进行批量删除：

```
📋 批量操作：
├── ✅ 全选/取消全选 - 快速选中当前页所有 API
└── 🗑️ 批量删除 - 删除所有选中的 API
```

**操作步骤：**
```
1. 勾选要操作的 API（可多选）
2. 点击顶部工具栏的 "全选" 按钮可快速选择当前页所有 API
3. 点击 "删除选中" 按钮
4. 确认删除操作
```

### 收藏 API

可以将常用或重要的 API 标记为收藏（Star）：

```
🌟 收藏功能：
├── 点击 API 卡片上的 ⭐ 图标收藏/取消收藏
├── 在左侧分类树中点击 "收藏" 查看所有收藏的 API
└── 收藏的 API 会显示黄色星标
```

---

## 🔍 搜索和筛选

### 搜索

支持多种搜索方式：

```
🔍 搜索选项：
├── 按名称搜索: "创建订单"
├── 按 URL 搜索: "/api/orders"
├── 按方法搜索: "POST"
├── 按标签搜索: "#核心功能"
└── 组合搜索: "POST orders #核心功能"
```

**快捷键：**
- `Ctrl/Cmd + K`: 打开快速搜索
- `Ctrl/Cmd + F`: 页面内搜索

### 筛选

```
🎯 筛选器：
├── 📁 按分类筛选
│   ├── 平台
│   ├── 组件
│   └── 功能
├── 🏷️ 按标签筛选
├── 📊 按方法筛选
│   ├── GET
│   ├── POST
│   ├── PUT
│   ├── DELETE
│   └── PATCH
├── 📅 按时间筛选
│   ├── 今天
│   ├── 本周
│   ├── 本月
│   └── 自定义
└── 📈 按使用情况
    ├── 常用（使用次数 > 10）
    ├── 偶尔使用（1-10 次）
    └── 未使用
```

### 排序

```
🔢 排序选项：
├── 名称 (A-Z / Z-A)
├── 创建时间 (新→旧 / 旧→新)
├── 更新时间 (新→旧 / 旧→新)
├── 使用次数 (高→低 / 低→高)
└── 响应时间 (快→慢 / 慢→快)
```

---

## 📂 分类管理

### 分类层级

AI TestMind 使用三层分类结构：

```
平台（Platform）
  └── 组件（Component）
      └── 功能（Feature）
```

**示例：**

```
电商平台
  ├── 用户管理
  │   ├── 用户注册
  │   ├── 用户登录
  │   └── 用户信息
  ├── 商品管理
  │   ├── 商品列表
  │   ├── 商品详情
  │   └── 商品创建
  └── 订单管理
      ├── 订单创建
      ├── 订单查询
      ├── 订单修改
      └── 订单删除
```

### 管理分类

**创建分类：**
```
1. 点击左侧 "分类管理" 面板
2. 点击 "添加分类" 按钮
3. 选择层级（平台/组件/功能）
4. 输入名称
5. 保存
```

**编辑分类：**
```
1. 右键点击分类名称
2. 选择 "重命名"
3. 输入新名称
4. 保存
```

**删除分类：**
```
1. 右键点击分类名称
2. 选择 "删除"
3. 选择如何处理该分类下的 API：
   - 移动到其他分类
   - 移动到"未分类"
   - 一起删除（危险操作）
4. 确认删除
```

**修改 API 分类：**
```
1. 点击 API 进入详情页或编辑页
2. 修改分类信息（平台/组件/功能）
3. 保存更改
```

💡 **提示**：如需批量修改多个 API 的分类，可以通过导出数据库、修改后重新导入的方式实现。

---

## 📥📤 导入API

### 导入API

**支持的格式：**
- 📦 **HAR 文件**: Chrome/Firefox/Postman 导出的 HAR
- 📄 **JSON 文件**: AI TestMind 标准格式
- 📋 **Postman Collection**: Postman 导出的 Collection
- 🌐 **OpenAPI/Swagger**: OpenAPI 3.0 / Swagger 2.0 规范

**导入步骤：**
```
1. 点击 "导入" 按钮
2. 选择文件格式
3. 上传文件或粘贴内容
4. 配置导入选项：
   - 自动分类
   - 重复处理（跳过/覆盖/创建新版本）
   - 标签处理
5. 预览导入结果
6. 确认导入
```
---

## 💡 最佳实践

### 1. 命名规范

**推荐命名格式：**
```
✅ 好的命名：
- 创建订单
- 查询用户列表
- 获取商品详情
- 更新库存
- 删除购物车项

❌ 不好的命名：
- POST /api/orders
- API_001
- test
- 接口1
- create
```

**命名原则：**
- 动词 + 名词（查询用户）
- 简洁明了
- 统一语言（全中文或全英文）
- 避免缩写

### 2. 分类管理

```
✅ 推荐分类结构：
平台名称（业务系统）
  └── 功能模块（业务领域）
      └── 具体功能（操作类型）

示例：
OA 系统
  └── 审批管理
      └── 发起审批
      └── 审批列表
      └── 审批详情
```

### 3. 标签使用

**推荐标签类型：**

```
🏷️ 功能标签：
- #核心功能
- #辅助功能
- #管理功能

🏷️ 状态标签：
- #需要登录
- #需要权限
- #公开接口

🏷️ 操作标签：
- #数据查询
- #数据修改
- #数据删除

🏷️ 优先级标签：
- #高优先级
- #中优先级
- #低优先级

🏷️ 测试标签：
- #已测试
- #待测试
- #有问题
```

### 4. 维护策略

**定期维护：**
```
✅ 每周维护清单：
- 检查未分类的 API
- 更新过期的 API 信息
- 删除重复的 API
- 补充缺失的响应示例
- 更新 API 使用统计
```

**版本管理：**
```
✅ API 版本策略：
- 记录 API 版本变更
- 保留历史版本
- 标注废弃的 API
- 提供迁移指南
```

### 5. 团队协作

```
✅ 协作建议：
- 统一命名规范
- 定期同步 API 库
- 使用标签标注负责人
- 记录重要变更
- 定期 Code Review
```

---

## ❓ 常见问题

### Q1: 如何处理重复的 API？

**场景**: 采集时发现有重复的 API。

**解决方案**:
```
手动处理：
1. 使用搜索功能找到重复的 API
2. 对比差异
3. 保留一个，删除其他
4. 必要时更新保留的 API 信息
```

### Q2: API 采集后分类不准确？

**原因**: 自动分类识别失败或 AI 分类不准确。

**解决方案**:
```
1. 点击 API 进入编辑页
2. 手动修改分类信息（平台/组件/功能）
3. 保存更改
4. 如需修改多个 API，可逐个编辑或通过数据库批量更新
```

### Q3: 如何快速找到某个 API？

**技巧**:
```
方式 1: 快速搜索
- 按 Ctrl/Cmd + K
- 输入关键词
- 选择结果

方式 2: 高级筛选
- 使用组合筛选条件
- 保存常用筛选为"视图"
- 一键切换视图

方式 3: 标签导航
- 点击感兴趣的标签
- 查看该标签下的所有 API
- 支持多标签筛选（AND/OR）
```

### Q4: API 信息不完整怎么办？

**场景**: 采集的 API 缺少请求参数或响应示例。

**解决方案**:
```
1. 手动补充信息：
   - 点击编辑 API
   - 填写缺失的字段
   - 添加示例值
   
2. 重新采集：
   - 使用 mitmproxy 完整采集
   - 确保捕获完整的请求和响应
   
3. 从文档导入：
   - 如果有 OpenAPI/Swagger 文档
   - 导入文档补充信息
```

### Q5: 如何备份 API 仓库？

**推荐方案**:
```
定期备份数据库文件：
1. 备份 SQLite 数据库文件
2. 保存到安全位置
3. 设置自动备份任务（参考"数据备份"章节）

自动备份脚本：
#!/bin/bash
DATE=$(date +%Y%m%d)
cp prisma/dev.db backup/dev-$DATE.db
gzip backup/dev-$DATE.db
```

### Q6: 团队如何共享 API 库？

**方案**:
```
方式 1: 数据库共享
- 使用共享数据库（PostgreSQL/MySQL）
- 团队成员连接同一数据库

方式 2: 导入API
- 定期导出 API 库
- 分享给团队成员
- 成员导入到本地

方式 3: Git 协作
- 导出 API 为 JSON
- 提交到 Git 仓库
- 团队成员拉取最新版本
```

---

## 🔗 相关文档

- [API 采集指南](05_API_CAPTURE.md) - 如何采集 API 到仓库
- [可视化编排指南](04_FLOW_ORCHESTRATION.md) - 如何使用仓库中的 API 编排测试
- [AI 生成指南](03_AI_GENERATION.md) - AI 如何使用仓库中的 API 生成测试

---

## 💡 下一步

掌握了 API 仓库管理后，你可以：

1. 📝 [使用 API 手动编排测试流程](04_FLOW_ORCHESTRATION.md)
2. 🤖 [让 AI 自动生成测试用例](03_AI_GENERATION.md)
3. ✅ [执行测试并查看结果](06_EXECUTION.md)

---

<div align="center">

**有问题？**

查看 [FAQ](../FAQ.md) 或加入 [Discord 社区](https://discord.gg/aitestmind)

[⬅️ 返回文档首页](../README.md)

</div>

